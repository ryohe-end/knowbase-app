version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        # === Amplify 環境変数を .env.production に書き出す ===
        # 値を '$変数名' とすることで、JSONの中身を壊さずに文字列として保存します
        - echo "QBUSINESS_APP_ID='$QBUSINESS_APP_ID'" >> .env.production
        - echo "QBUSINESS_INDEX_ID='$QBUSINESS_INDEX_ID'" >> .env.production
        - echo "QBUSINESS_REGION='$QBUSINESS_REGION'" >> .env.production
        - echo "TEMPLATE_FILE_ID='$TEMPLATE_FILE_ID'" >> .env.production
        - echo "GOOGLE_SERVICE_ACCOUNT_JSON='$GOOGLE_SERVICE_ACCOUNT_JSON'" >> .env.production
        - echo "TEMPLATE_COPY_PARENT_FOLDER_ID='$TEMPLATE_COPY_PARENT_FOLDER_ID'" >> .env.production
        # ===============================================

    build:
      commands:
        - npm run build

  artifacts:
    baseDirectory: .next
    files:
      - "**/*"

  cache:
    paths:
      - node_modules/**/*
